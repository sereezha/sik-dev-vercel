---
import { ModalIds } from 'src/constants/modals';
import Button from '../Button.astro';
import Modal from '../Modal.astro';
---

<Modal type="info" showOnMount id={ModalIds.ADULT_MODAL}>
  <Fragment slot="title">
    Будь ласка, підтвердіть, <span class="wh-nowrap">що вам</span> 18+ років для
    перегляду сайту.
  </Fragment>
  <Fragment slot="buttons">
    <Button fullWidth appearance="text" data-action="under-18"
      >Я ще неповнолітній</Button
    >
    <Button fullWidth data-action="over-18">Мені більше 18</Button>
  </Fragment>
</Modal>

<script>
  import { LocalStorageKeys } from 'src/constants/storage';
  import { ModalIds } from 'src/constants/modals';

  const id = ModalIds.ADULT_MODAL;

  document.addEventListener('DOMContentLoaded', () => {
    const adultModal = document.getElementById(id);

    adultModal?.addEventListener('click', (event) => {
      const target = event.target as HTMLElement;
      const action = target.getAttribute('data-action');
      if (!action) return;

      const title = adultModal.querySelector(`#${id}-title`)!;

      if (action === 'under-18') {
        title.textContent =
          'Ви маєте бути повнолітнім щоб переглядати цей сайт.';
      } else {
        window.modalController.destroy(id);
        localStorage.setItem(LocalStorageKeys.ADULT_MODAL, 'true');
      }
    });
  });
</script>
